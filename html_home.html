<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roster - Karlendar</title>
  <link rel="icon" href="https://static-assets-5sa.pages.dev/roster/favicon.svg" type="image/svg">
  <style type="text/css">
      h1 {
        text-align: center;
      }
      h2 {
        text-align: center;
      }
      body {
        background-color: #f0f0f2;
        margin: 0;
        padding: 0;
        font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
      }
      #main {
        width: 750px; /* Default width for desktop */
        margin: 2em auto; /* Default margin for desktop */
        padding: 2em;
        background-color: #fdfdff;
        border-radius: 0.5em;
        box-shadow: 2px 3px 7px 2px rgba(0,0,0,0.02);
      }
      #amLink {
        width: 100%; /* Set width to 100% by default */
      }
      #generateBtn {
        padding: 5px 10px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      #generateBtn:hover {
        background-color: #45a049;
      }
      @media (max-width: 700px) {
        #main {
          width: auto; /* Adjust to full width for small devices */
          margin: 0 auto; /* Center horizontally for small devices */
        }
        #amLink {
          width: 50%; /* Set a smaller width for larger screens */
          max-width: 300px; /* Set a maximum width to prevent excessive stretching */
        }
      }
      .collapsible {
      background-color: #777;
      color: white;
      cursor: pointer;
      padding: 18px;
      width: 100%;
      border: none;
      text-align: center;
      outline: none;
      font-size: 15px;
      }
      .icons {
      text-align: center;
      margin-top: 20px;
      }
      .icons img {
      padding: 0px 10px 0px 10px;
      }
      .content {
      padding: 0 18px;
      display: none;
      overflow: hidden;
      background-color: #f1f1f1;
      }
      .active, .collapsible:hover {
      background-color: #555;
      }
      .generated-link-container {
        position: relative;
        margin-top: 20px;
        display: none;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
      }

      .generated-link-content {
        word-wrap: anywhere;
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .copy-link-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        padding: 5px 10px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }

      .copy-link-btn:hover {
        background-color: #45a049;
      }
      a:link, a:visited { color: #6911Ff; text-decoration: none;}
  </style>
</head>
<body>
  <div id="main">
    <h1>Roster Access 'Karlendar'</h1>
    <h2>Air Maestro via Okta has the final say!</h2>
    <p>The information below will provide information about this project but remember that Air Maestro via Okta along with any calls or messages from Operations has the final say. This should reflect any changes within Air Maestro, but it may take up to 48 hours depending on the calendar service you subscribe to. This is an additional tool to make life easier with checking the roster and making plans. I will not accept any responsibility for anyone missing or running late for shifts.</p>
    <p>You can generate your personal Air Maestro Calendar Link by scrolling to the bottom of the Schedule page of Air Maestro once you sign into Okta.</p>
    <p><img src="https://static-assets-5sa.pages.dev/roster/instructions/AM-Integration.png" width="316" height="161" style="border-width: 1px; border-style: solid;" alt="AM-Integration"></p>
    <p>Generate (if not already active) and Copy the Calendar Link from Air Maestro and paste it in the field below and click the "Generate Modified Link" button. A new subscription URL will be created which you use in any calendar service you choose. It's recommended to complete this on the main device you plan on viewing the calendar on. This can be completed using a company computer, but it may not allow you access to your personal calendars or allow copy and paste of the long link.</p>
    <form id="myform" name="myform">
      <label for="amLink"><mark><b>Paste Air Maestro External Link Here:</b><mark></label><br>
      <input type="text" id="amLink" name="amLink"><br>
      <br>
      <button type="button" id="generateBtn">Generate Modified Link</button>
    </form>
    <div id="generatedLink" class="generated-link-container">
      <div id="generatedLinkContent" class="generated-link-content"></div>
      <button id="copyLinkBtn" class="copy-link-btn">Copy Link</button>
    </div>
    <div class="icons">
      <a id="google" href="https://calendar.google.com/calendar/u/0/r/settings/addbyurl" target="_blank"><img src="https://static-assets-5sa.pages.dev/roster/icons/Google_Calendar.svg" alt="Google Calendar" width="48" height="48"></a> <a id="outlook" href="https://outlook.live.com/calendar/addcalendar?name=Air%20Maestro&amp;url=" target="_blank"><img src="https://static-assets-5sa.pages.dev/roster/icons/MS_Outlook.svg" alt="Personal M365" width="48" height="48"></a> <a id="corporate" href="https://outlook.office.com/calendar/addcalendar?name=Air%20Maestro&amp;url=" something="" target="_blank"><img src="https://static-assets-5sa.pages.dev/roster/icons/m365-business.png" alt="Corporate M365" width="120" height="48"></a>
    </div>
    <h2>Setup Instructions</h2>
    <p>Air Maestro provider Avinet has an existing how-to guide for various platforms <a href="https://avinet.atlassian.net/wiki/spaces/AMKB/pages/816218113" target="_blank">here</a>, but I've put together some instruction for Google Calendar, Outlook Web and Apple Calendar. This is best completed on&nbsp;</p>
    <p><mark><b>Note:</b> Currently adding external calendars using a <u>company managed Outlook Desktop application is not supported</u> but will show up there shortly after adding it using the web version.</mark></p>
    <p></p>
    <button type="button" class="collapsible"><b>Google Calendar</b></button>
    <div class="content">
      <p>With you newly modified URL copied, complete the following.</p>
      <ul>
        <li>Click <a href="https://calendar.google.com/calendar/u/0/r/settings/addbyurl" target="_blank">here</a> or the icon above to go to the Google Calendar web page,<br>
          If the link launches the application on your phone, close it and long press the link and select open in new window - some phones are smarter than they should be...
        </li>
        <li>You may need to sign into the Google account that you wish to add the calendar to,</li>
        <li>Paste the modified URL into the "URL of calendar" field and select "Add calendar",<br>
        <img src="https://static-assets-5sa.pages.dev/roster/instructions/Add-Google-Calendar.png" width="324" height="200" style="border-width: 1px; border-style: solid;" alt="Add-Google-Calendar"></li>
        <li>Once added, it may take few minutes before events start to show in your calendar on the web version,<br>
        <img src="https://static-assets-5sa.pages.dev/roster/instructions/Google-Other-Calendars.png" width="145" height="58" style="border-width: 1px; border-style: solid;" alt="Google-Other-Calendars"></li>
      </ul>
      <p>If your newly added calendar doesn't show on your mobile device, you will need to do the following,</p>
      <ul>
        <li>Open the calendar application,</li>
        <li>Go to Settings from the menu button,</li>
        <li>Select Show More,<br>
        <img src="https://static-assets-5sa.pages.dev/roster/instructions/Google-App-Settings.png" width="200" height="259" style="border-width: 1px; border-style: solid;" alt="Google-App-Settings"></li>
        <li>Find the calendar, select Sync and choose your colour,<br>
        <img src="https://static-assets-5sa.pages.dev/roster/instructions/Google-App-Sync.png" width="200" height="192" style="border-width: 1px; border-style: solid;" alt="Google-App-Sync"></li>
        <li>You should now be able to back yourself out of the menu and admire your new calendar.</li>
      </ul>
    </div>
    <p></p>
    <button type="button" class="collapsible"><b>Outlook Online Web App</b></button>
    <div class="content">
      <p>With you newly modified URL copied, complete the following.</p>
      <ul>
        <li>Click <a href="https://outlook.live.com/calendar/addcalendar?name=Air%20Maestro&amp;url=" target="_blank">here</a> or the Outlook icon above to go to your personal Outlook Calendar web page,<br>
          Click <a href="https://outlook.office.com/calendar/addcalendar?name=Air%20Maestro&amp;url=" target="_blank">here</a> or the Microsoft Business icon above to go to the corporate M365 Calendar web page,<br>
          If the link launches the application on your phone, close it and long press the link and select open in new window - some phones are smarter than they should be...
        </li>
        <li>You may need to sign into the account that you wish to add the calendar to,</li>
        <li>Paste the modified URL into the field, give it a name and select "Import",<br>
        <img src="https://static-assets-5sa.pages.dev/roster/instructions/Add-Outlook-Calendar.png" width="467" height="250" style="border-width: 1px; border-style: solid;" alt="Add-Outlook-Calendar"></li>
        <li>It will say imported successfully and then you may browse the calendar,</li>
      </ul>
      <p>If your newly added calendar doesn't show on your mobile device, you will need to do the following,</p>
      <ul>
        <li>Open the calendar application,</li>
        <li>Go to the view options generally by clicking on your picture or account identifier,</li>
        <li>Select the new calendar to display,<br>
        <img src="https://static-assets-5sa.pages.dev/roster/instructions/Outlook-App-View.png" width="252" height="250" style="border-width: 1px; border-style: solid;" alt="Outlook-App-View"></li>
        <li>You should now be able to back yourself out of the menu and admire your new calendar.</li>
      </ul>
    </div>
    <p></p>
    <button type="button" class="collapsible"><b>Apple Calendar</b></button>
    <div class="content">
      <p>With you newly modified URL copied, complete the following. If you generated the modified URL on a PC, you may need to send that link to your phone as an email or note so you can copy the link on your device.</p>
      <ul>
        <li>Open the calendar application,</li>
        <li>Select the calendar icon in the top-left,</li>
        <li>Select "Add Calendar" in the bottom-left,</li>
        <li>Select "Add Subscription Calendar",<br>
        <img src="https://static-assets-5sa.pages.dev/roster/instructions/Apple-Calendar-Add.png" width="200" height="487" style="border-width: 1px; border-style: solid;" alt="Apple-Calendar-Add"></li>
        <li>Paste the modified URL into the field and save it,</li>
        <li>You should now be able to back yourself out of the menu and admire your new calendar.</li>
      </ul>
    </div>
    <p><b>Note:</b> Duty and Tasking Sign On - your sign on time should match the tasking event in your calendar. The web version of Air Maestro will continue to display a DUTY SHIFT overlapping with a TASKING SHIFT. The calendar service has been adjusted <u>as per "standard roster protocols"</u> to extend the TASKING SHIFT and remove the DUTY SHIFT.</p>
    <p></p>
    <button type="button" class="collapsible"><b>What this link does</b></button>
    <div class="content">
      <p>This Project retrieves your calendar from Air Maestro and adjusts the following.</p>
      <ul>
        <li>Corrects the TIMEZONE of the calendar to be suitable as per Air Maestro outputs,</li>
        <li>Duplicate Leave types removed,</li>
        <li>Duplicate Day Off types removed,</li>
        <li>Duplicate Standby events removed,</li>
        <li>Duplicate Admin events removed,</li>
        <li>Assigned Base events removed,</li>
        <li>All Day events such as RDOs formatted correctly,</li>
        <li>Event names simplified e.g.,"RDO - Rostered Day Off", now "RDO",</li>
        <li>Recency events displayed correctly for the specific day e.g., Night Surv or EPs,</li>
        <li>Time Stamp of last Roster Sync between your calendar and Air Maestro added as the first line of all events for awareness.</li>
      </ul>
    </div>
    <p></p>
    <button type="button" class="collapsible"><b>FAQs</b></button>
    <div class="content">
      <ul>
        <li>Each sync request from your calendar service is retrieved from Air Maestro, corrected and filtered, and then pushed to your calendar,</li>
        <li>No calendar event data is saved within this project,</li>
        <li>Event start times will display in your local calendar time – If you have a 0600H sign on in Broome but your phone is still set to Darwin Time, the event will show as 0730I/K until your phone clock updates to WA,</li>
        <li>If you generate a new link in Air Maestro – you will need to generate a new link with this website, remove your old calendar and add a new one with the new link generated,</li>
        <li>Depending on your calendar service, it may take a short time to initially populate with events (anywhere from 5 minutes to 1 hour),</li>
        <li><strong>Updates may occur only once every 24 hours</strong>, but it varies between calendar services (anywhere from every 4 to 48 hours) - This is up to your calendar service and Air Maestro, I can't control it. If updates do not occur past 48 hours, there may be an issue and hopefully it'll be resolved shortly.</li>
      </ul>
      <p>I have adjusted the calendar processing to suite the many but if you have any suggestions or ideas that could improve it, please let me know.</p>
    </div>
    <p></p>
    <button type="button" class="collapsible"><b>Advanced API Options</b></button>
    <div class="content">
      <p>If you find that the output is not to your liking or suitable for your needs, there may be a way to personalise it with the use of API parameters.</p>
      <ul>
        <li><del>If you want your duty and tasking to show separately, append your generated URL with <b>&amp;overlap=true</b></del></li>
        <li>If you want your events to not show the time of last sync because of notifications you have already set up for changed events, append your generated URL with <b>&amp;hideupdate=true</b></li>
        <li>More options to come if the need calls for it...</li>
      </ul>
    </div>
    <p>If you have any questions regarding how this project has been built, you can review the code on <a href="https://github.com/123gizi/cloudflare-roster-proxy" target="_blank">GitHub</a>.</p>
    <script>
      let generateBtn = document.getElementById('generateBtn');
      let generatedLinkContainer = document.getElementById('generatedLink');
      let generatedLinkContent = document.getElementById('generatedLinkContent');
      let copyLinkBtn = document.getElementById('copyLinkBtn');
      let outlookLink = document.getElementById('outlook');
      let corporateLink = document.getElementById('corporate');

      generateBtn.addEventListener('click', function() {
        let amLink = document.getElementById('amLink').value;
        let modifiedLink = window.location.toString() + "?url=" + encodeURIComponent(amLink);
        generatedLinkContent.textContent = modifiedLink;
        generatedLinkContainer.style.display = "block";
        
        // Update Outlook and Corporate links
        outlookLink.href = "https://outlook.live.com/calendar/addcalendar?name=Air%20Maestro&url=" + encodeURIComponent(modifiedLink);
        corporateLink.href = "https://outlook.office.com/calendar/addcalendar?name=Air%20Maestro&url=" + encodeURIComponent(modifiedLink);
      });

      copyLinkBtn.addEventListener('click', function() {
        let modifiedLink = generatedLinkContent.textContent;
        if (navigator.clipboard) {
          navigator.clipboard.writeText(modifiedLink)
            .then(() => {
              alert('Link copied to clipboard');
            })
            .catch(err => {
              console.error('Failed to copy link: ', err);
            });
        } else {
          let textArea = document.createElement('textarea');
          textArea.value = modifiedLink;
          textArea.style.position = 'fixed';
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();

          try {
            let successful = document.execCommand('copy');
            let msg = successful ? 'successful' : 'unsuccessful';
            alert('Link copied to clipboard');
          } catch (err) {
            console.error('Failed to copy link: ', err);
          }

          document.body.removeChild(textArea);
        }
      });
    </script>
    <script>
      var coll = document.getElementsByClassName("collapsible");
      var i;

      for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
          this.classList.toggle("active");
          var content = this.nextElementSibling;
          if (content.style.display === "block") {
            content.style.display = "none";
          } else {
            content.style.display = "block";
          }
        });
      }
    </script>
  </div>
</body>
</html>
